nc: 1  # ç°å°˜ç±»åˆ«
scales:
  n: [0.50, 0.25, 1024]  # depth_multiple=0.50, width_multiple=0.25
  s: [0.50, 0.50, 1024]  # depth_multiple=0.50, width_multiple=0.50

# ğŸ“Œ å…³é”®é€šé“æµï¼ˆn scaleï¼‰ï¼š
# P0: 3ch -> P1: 32ch -> P2: 32ch -> P3: 128ch -> DINO: 256ch -> P4: 256ch -> P5: 512ch
# æ£€æµ‹å¤´ï¼šP2(32ch), P3(128ch), P4(256ch), P5(512ch)

backbone:
  # === 1. P0 æ³¨å…¥ (DINO é¢„å¤„ç†å±‚) ===
  # è¾“å…¥: (B, 3, 1024, 1024) [Raw, Bilateral, CLAHE]
  # è¾“å‡º: (B, 3, 1024, 1024) DINO å¢å¼ºå›¾
  - [-1, 1, DINO3Preprocessor, [3]]      # 0 (P0)

  # === 2. æ ‡å‡†å·ç§¯ä¸‹é‡‡æ · ===
  - [-1, 1, Conv, [64, 3, 2]]            # 1 (P1/2: 32ch in n scale)
  - [-1, 1, Conv, [128, 3, 2]]           # 2 (P2/4: 32ch in n scale - æå°ç›®æ ‡æ ¸å¿ƒç‰¹å¾å±‚)
  - [-1, 2, C3k2, [256, False, 0.25]]    # 3 (64ch in n scale)
  - [-1, 1, Conv, [256, 3, 2]]           # 4 (P3/8: 64ch in n scale)
  - [-1, 2, C3k2, [512, False, 0.25]]    # 5 (P3ç‰¹å¾å±‚: n scale ä¸‹ 128ch)

  # === 3. P3 æ³¨å…¥ (DINO ç‰¹å¾å¢å¼º) ===
  # è¾“å…¥: (B, 128, 128, 128) - n scale ä¸‹çš„ P3 ç‰¹å¾
  # è¾“å‡º: (B, 256, 128, 128) - DINO å¢å¼ºåçš„ç‰¹å¾ï¼Œä¸º P4 åšå‡†å¤‡
  # æ³¨æ„ï¼šè¾“å‡º 256 é€šé“ä»¥åŒ¹é…åç»­ Conv å±‚çš„è¾“å…¥é¢„æœŸ
  - [-1, 1, DINO3Backbone, [256]]        # 6 (P3-Enhanced: 128 -> 256ch)

  - [-1, 1, Conv, [512, 3, 2]]           # 7 (P4/16)
  - [-1, 2, C3k2, [512, True]]           # 8
  - [-1, 1, Conv, [1024, 3, 2]]          # 9 (P5/32)
  - [-1, 2, C3k2, [1024, True]]          # 10
  
  # === 4. SPPELAN æ›¿æ¢ SPPF (Linking æ”¹è¿›) ===
  - [-1, 1, SPPELAN, [1024, 5]]          # 11 â­ æ›´é«˜æ•ˆçš„ç©ºé—´é‡‘å­—å¡”æ± åŒ–
  - [-1, 2, C2PSA, [1024]]               # 12 (ä¿æŒä¸»å¹²æœ€åçš„è‡ªæ³¨æ„åŠ›)

head:
  # === 5. ä¸Šé‡‡æ ·è·¯å¾„ (Neck) - ä½¿ç”¨ C3k2PC åŠ é€Ÿ ===
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 13
  - [[-1, 8], 1, Concat, [1]]            # 14 (P5 + P4)
  - [-1, 3, C3k2PC, [512]]               # 15 â­ PConv åŠ é€Ÿç‰ˆ

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 16
  - [[-1, 6], 1, Concat, [1]]            # 17 (P4 + P3-DINO)
  - [-1, 3, C3k2PC, [256]]               # 18 â­ PConv åŠ é€Ÿç‰ˆ

  # === 6. P2 é«˜åˆ†è¾¨ç‡å±‚ (é’ˆå¯¹å¾®å°ç°å°˜) ===
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 19
  - [[-1, 2], 1, Concat, [1]]            # 20 (P3 + P2)
  - [-1, 3, C3k2PC, [128]]               # 21 â­ PConv åŠ é€Ÿç‰ˆ (P2 æ£€æµ‹åˆ†æ”¯)
  - [-1, 1, SeNet, [128]]                # 22 â­ é€šé“æ³¨æ„åŠ›ï¼ˆæå‡ Recallï¼‰

  # === 7. ä¸‹é‡‡æ ·èåˆè·¯å¾„ ===
  - [-1, 1, Conv, [128, 3, 2]]           # 23
  - [[-1, 18], 1, Concat, [1]]           # 24 (P2 -> P3)
  - [-1, 3, C3k2PC, [256]]               # 25 â­ PConv åŠ é€Ÿç‰ˆ

  - [-1, 1, Conv, [256, 3, 2]]           # 26
  - [[-1, 15], 1, Concat, [1]]           # 27 (P3 -> P4)
  - [-1, 3, C3k2PC, [512]]               # 28 â­ PConv åŠ é€Ÿç‰ˆ

  - [-1, 1, Conv, [512, 3, 2]]           # 29
  - [[-1, 12], 1, Concat, [1]]           # 30 (P4 -> P5)
  - [-1, 3, C3k2PC, [1024]]              # 31 â­ PConv åŠ é€Ÿç‰ˆ

  # === 8. æ£€æµ‹å¤´ ===
  - [[22, 25, 28, 31], 1, Detect, [nc]]  # 32 (P2, P3, P4, P5)