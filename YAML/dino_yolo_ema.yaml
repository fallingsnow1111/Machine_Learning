nc: 1  # ç°å°˜ç±»åˆ«
scales:
  n: [0.50, 0.25, 1024]  # depth_multiple=0.50, width_multiple=0.25
  s: [0.50, 0.50, 1024]  # depth_multiple=0.50, width_multiple=0.50

# ðŸ“Œ å…³é”®é€šé“æµï¼ˆn scaleï¼‰ï¼š
# P0: 3ch -> P1: 32ch -> P2: 32ch -> P3: 128ch -> DINO: 256ch -> P4: 256ch -> P5: 512ch
# æ£€æµ‹å¤´ï¼šP2(32ch), P3(128ch), P4(256ch), P5(512ch)

backbone:
  # === 1. P0 æ³¨å…¥ (DINO é¢„å¤„ç†å±‚) ===
  # è¾“å…¥: (B, 3, 1024, 1024) [Raw, Bilateral, CLAHE]
  # è¾“å‡º: (B, 3, 1024, 1024) DINO å¢žå¼ºå›¾
  - [-1, 1, DINO3Preprocessor, [3]]      # 0 (P0)

  # === 2. æ ‡å‡†å·ç§¯ä¸‹é‡‡æ · ===
  - [-1, 1, Conv, [64, 3, 2]]            # 1 (P1/2: 32ch in n scale)
  - [-1, 1, Conv, [128, 3, 2]]           # 2 (P2/4: 32ch in n scale - æžå°ç›®æ ‡æ ¸å¿ƒç‰¹å¾å±‚)
  - [-1, 2, C3k2, [256, False, 0.25]]    # 3 (64ch in n scale)
  - [-1, 1, Conv, [256, 3, 2]]           # 4 (P3/8: 64ch in n scale)
  - [-1, 2, C3k2, [512, False, 0.25]]    # 5 (P3ç‰¹å¾å±‚: n scale ä¸‹ 128ch)

  # === 3. P3 æ³¨å…¥ (DINO ç‰¹å¾å¢žå¼º) ===
  # è¾“å…¥: (B, 128, 128, 128) - n scale ä¸‹çš„ P3 ç‰¹å¾
  # è¾“å‡º: (B, 256, 128, 128) - DINO å¢žå¼ºåŽçš„ç‰¹å¾ï¼Œä¸º P4 åšå‡†å¤‡
  # æ³¨æ„ï¼šè¾“å‡º 256 é€šé“ä»¥åŒ¹é…åŽç»­ Conv å±‚çš„è¾“å…¥é¢„æœŸ
  - [-1, 1, DINO3Backbone, [256]]        # 6 (P3-Enhanced: 128 -> 256ch)

  - [-1, 1, Conv, [512, 3, 2]]           # 7 (P4/16)
  - [-1, 2, C3k2, [512, True]]           # 8
  - [-1, 1, Conv, [1024, 3, 2]]          # 9 (P5/32)
  - [-1, 2, C3k2, [1024, True]]          # 10
  
  # === 4. SPPF æ›¿æ¢ ASPP (æ›´ç¨³å¥çš„æ± åŒ–) ===
  - [-1, 1, SPPF, [1024, 5]]             # 11
  - [-1, 2, C2PSA, [1024]]               # 12 (ä¿æŒä¸»å¹²æœ€åŽçš„è‡ªæ³¨æ„åŠ›)

head:
  # === 5. ä¸Šé‡‡æ ·è·¯å¾„ (Neck) ===
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 13
  - [[-1, 8], 1, Concat, [1]]            # 14 (P5 + P4)
  - [-1, 2, C3k2, [512, False]]          # 15
  - [-1, 1, EMA, [512]]                  # 16 â­ P4 Attention (æå‡ä¸­ç­‰ç›®æ ‡èšç„¦)

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 17
  - [[-1, 6], 1, Concat, [1]]            # 18 (P4 + P3-DINO)
  - [-1, 2, C3k2, [256, False]]          # 19
  - [-1, 1, EMA, [256]]                  # 20 â­ P3 Attention (æå‡å°ç›®æ ‡èšç„¦)

  # === 6. P2 é«˜åˆ†è¾¨çŽ‡å±‚ (é’ˆå¯¹å¾®å°ç°å°˜) ===
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 21
  - [[-1, 2], 1, Concat, [1]]            # 22 (P3 + P2)
  - [-1, 2, C3k2, [128, False]]          # 23 (P2 æ£€æµ‹åˆ†æ”¯)
  - [-1, 1, EMA, [128]]                  # 24 â­ P2 Attention (æ ¸å¿ƒï¼šèšç„¦å¾®å°ç°å°˜ï¼Œæå‡ Recall)

  # === 7. ä¸‹é‡‡æ ·èžåˆè·¯å¾„ ===
  - [-1, 1, Conv, [128, 3, 2]]           # 25
  - [[-1, 20], 1, Concat, [1]]           # 26 (P2 -> P3, å¼•ç”¨åŠ äº†EMAçš„P3å±‚)
  - [-1, 2, C3k2, [256, False]]          # 27

  - [-1, 1, Conv, [256, 3, 2]]           # 28
  - [[-1, 16], 1, Concat, [1]]           # 29 (P3 -> P4, å¼•ç”¨åŠ äº†EMAçš„P4å±‚)
  - [-1, 2, C3k2, [512, False]]          # 30

  - [-1, 1, Conv, [512, 3, 2]]           # 31
  - [[-1, 12], 1, Concat, [1]]           # 32 (P4 -> P5)
  - [-1, 2, C3k2, [1024, True]]          # 33

  # === 8. æ£€æµ‹å¤´ ===
  - [[24, 27, 30, 33], 1, Detect, [nc]]  # 34 (P2, P3, P4, P5 æ£€æµ‹åˆ†æ”¯)