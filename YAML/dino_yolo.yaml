# YOLO11 Dust Detection: DINOv2 (P0+P3) + P2 Head + ASPP + EMA
# ä¸“é—¨é’ˆå¯¹ç°åº¦å°ç›®æ ‡ç°å°˜æ£€æµ‹çš„èåˆæ¶æ„
# 
# æ ¸å¿ƒæ”¹è¿›ï¼š
# 1. P0 å±‚ï¼šDINO è¾“å…¥æ³¨å…¥ï¼Œå¢å¼ºç°åº¦å›¾è¯­ä¹‰ä¿¡æ¯
# 2. P3 å±‚ï¼šDINO ä¸­é—´ç‰¹å¾æ³¨å…¥ï¼Œæå‡ç‰¹å¾è´¨é‡
# 3. P2 æ£€æµ‹å¤´ï¼šæ•æ‰å¾®å°ç°å°˜ï¼ˆ1024 åˆ†è¾¨ç‡ä¸‹çš„åƒç´ çº§ç›®æ ‡ï¼‰
# 4. ASPPï¼šæ‰©å¤§æ„Ÿå—é‡ï¼Œæ›¿æ¢ SPPF
# 5. EMAï¼šåœ¨ P2/P3/P4 å±‚åŠ å…¥æ³¨æ„åŠ›æœºåˆ¶

nc: 1  # ç°å°˜ç±»åˆ«æ•°
scales: # ä½¿ç”¨ n æˆ– s ç‰ˆæœ¬ï¼Œæ ¹æ®æ˜¾å­˜è°ƒæ•´
  n: [0.50, 0.25, 1024]
  s: [0.50, 0.50, 1024]

backbone:
  # [from, repeats, module, args]
  
  # === 1. P0 æ³¨å…¥ (DINO é¢„å¤„ç†) ===
  # è¾“å…¥ï¼š(B, 1, H, W) ç°åº¦å›¾ æˆ– (B, 3, H, W) RGB å›¾
  # è¾“å‡ºï¼š(B, 3, H, W) DINO å¢å¼ºçš„ä¼ªå½©è‰²å›¾
  # args: [model_name, output_channels]
  # æœ¬åœ°ï¼š'./models/dinov3-vitl16'  Kaggleï¼š'/kaggle/input/dinov3-vitl16/dinov3-vitl16'
  - [-1, 1, DINO3Preprocessor, ["'/kaggle/input/dinov3-vitl16/dinov3-vitl16'", 3]]  # 0. P0 å±‚æ³¨å…¥
  
  # === 2. æ ‡å‡† Backbone å¼€å§‹ ===
  - [-1, 1, Conv, [64, 3, 2]]       # 1. P1/2
  - [-1, 1, Conv, [128, 3, 2]]      # 2. P2/4
  - [-1, 2, C3k2, [256, False, 0.25]]  # 3.
  - [-1, 1, Conv, [256, 3, 2]]      # 4. P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]  # 5. P3 ç‰¹å¾å±‚

  # === 3. P3 æ³¨å…¥ (DINO ä¸­å±‚å¢å¼º) ===
  # è¾“å…¥ï¼š(B, C, H/8, W/8) P3 ç‰¹å¾
  # è¾“å‡ºï¼š(B, 128, H/8, W/8) DINO å¢å¼ºåçš„ P3 ç‰¹å¾
  # args: [model_name, output_channels] - output_channels ä¼šè‡ªåŠ¨ç¼©æ”¾ (128*0.25=32 in 'n' model)
  # æ³¨æ„ï¼šc1 ç”± YOLO è‡ªåŠ¨ä¼ å…¥ï¼Œä¸éœ€è¦åœ¨ YAML ä¸­æŒ‡å®š
  # æœ¬åœ°ï¼š'./models/dinov3-vitl16'  Kaggleï¼š'/kaggle/input/dinov3-vitl16/dinov3-vitl16'
  - [-1, 1, DINO3Backbone, ["'/kaggle/input/dinov3-vitl16/dinov3-vitl16'", 128]]  # 6. P3 å±‚æ³¨å…¥

  - [-1, 1, Conv, [512, 3, 2]]      # 7. P4/16
  - [-1, 2, C3k2, [512, True]]      # 8.
  - [-1, 1, Conv, [1024, 3, 2]]     # 9. P5/32
  - [-1, 2, C3k2, [1024, True]]     # 10.
  
  # === 4. ASPP æ›¿æ¢ SPPF (æ‰©å¤§æ„Ÿå—é‡) ===
  # args: [c2, rates] - c2 æ”¾ç¬¬ä¸€ä½ï¼ä¼šè‡ªåŠ¨ç¼©æ”¾ (1024*0.25=256 in 'n' model)
  - [-1, 1, ASPP, [1024, [1, 6, 12, 18]]]  # 11. 
  - [-1, 2, C2PSA, [1024]]                  # 12.

head:
  # === 5. Neck éƒ¨åˆ† ===
  # P5 -> P4
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  # 13
  - [[-1, 8], 1, Concat, [1]]       # 14. ğŸ”´ ä¿®æ­£ï¼šåŸæŒ‡å‘ Layer 6 (P4)ï¼Œç°åœ¨ P4 æ˜¯ Layer 8
  - [-1, 2, C3k2, [512, False]]     # 15
  - [-1, 1, EMA, [512, 8]]          # 16. P4 Attention (c2=512, factor=8)

  # P4 -> P3
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  # 17
  - [[-1, 6], 1, Concat, [1]]       # 18. ğŸ”´ ä¿®æ­£ï¼šåŸæŒ‡å‘ Layer 4 (P3)ï¼Œç°åœ¨ P3 ç» DINO å¢å¼ºåæ˜¯ Layer 6
  - [-1, 2, C3k2, [256, False]]     # 19
  - [-1, 1, EMA, [256, 8]]          # 20. P3 Attention (c2=256, factor=8)

  # === 6. P2 é«˜åˆ†è¾¨ç‡å±‚ (é’ˆå¯¹å¾®å°ç°å°˜) ===
  # P3 -> P2
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  # 21
  - [[-1, 2], 1, Concat, [1]]       # 22. âœ… ä¿æŒï¼šP2 ä»åœ¨ Layer 2
  - [-1, 2, C3k2, [128, False]]     # 23
  - [-1, 1, EMA, [128]]             # 24. P2 Attention (å…³é”®ï¼)

  # === 7. ä¸‹é‡‡æ ·è·¯å¾„ ===
  # P2 -> P3
  - [-1, 1, Conv, [128, 3, 2]]      # 25
  - [[-1, 20], 1, Concat, [1]]      # 26. âœ… æŒ‡å‘ Layer 20 (P3 with EMA)
  - [-1, 2, C3k2, [256, False]]     # 27

  # P3 -> P4
  - [-1, 1, Conv, [256, 3, 2]]      # 28
  - [[-1, 16], 1, Concat, [1]]      # 29. âœ… æŒ‡å‘ Layer 16 (P4 with EMA)
  - [-1, 2, C3k2, [512, False]]     # 30

  # P4 -> P5
  - [-1, 1, Conv, [512, 3, 2]]      # 31
  - [[-1, 12], 1, Concat, [1]]      # 32. âœ… ä¿æŒï¼šæŒ‡å‘ Layer 12 (C2PSA after ASPP)
  - [-1, 2, C3k2, [1024, True]]     # 33

  # === 8. å¤šå°ºåº¦æ£€æµ‹å¤´ ===
  # è¾“å‡º 4 ä¸ªå°ºåº¦ï¼šP2 (1/4), P3 (1/8), P4 (1/16), P5 (1/32)
  - [[24, 27, 30, 33], 1, Detect, [nc]]  # 34. Detect(P2, P3, P4, P5)
